# javascript垃圾回收

## 垃圾回收&GC算法

### JavaScript 自动垃圾收集机制

垃圾回收又称为 GC(Garbage Collecation)。编写 JavaScript 程序时，开发者不需要手工跟踪内存的使用情况，只要按照标准写 JavaScript 代码，JavaScript 程序运行所需内存的分配以及无用内存的回收完全是自动管理。JavaScript 中自动垃圾回收机制的原理为:

* 找出那些不再使用的变量，然后释放其占用的内存。
* 垃圾收集器会按照固定的时间间隔(或预定的收集时间)周期性地执行此操作。

### 引用计数算法

引用计数(reference counting) 是一种垃圾收集策略。引用计数的本质是——跟踪记录每个值被引用的次数。执行机制如下：

* 核心思想: 设置引用数，判断当前引用数是否为0
* 引用计数器
* 引用关系改变时修改引用数字
* 引用数字为0时立即回收

**优点：**

* 发现垃圾立即回收，
* 最大限度减少程序暂停

**缺点：**

* 无法回收循环引用的对象
* 时间开销大

### 标记清除算法

标记清除(mark-and-sweep) 是 JavaScript 中最常用的垃圾回收方式。其执行机制如下：

* 核心思想：分标记和清除两个阶段完成
* 遍历所有对象找标记活动对象
* 遍历所有对象清除没有标记的对象
* 回收相应的空间

**优点:**

* 可以释放无法访问的循环引用对象
* 必要时才回收(内存不足时)

**缺点:**

* 回收时，应用需要挂起，也就是stop the world。
* 标记和清除的效率不高，尤其是要扫描的对象比较多的时候
* 会造成内存碎片化(会导致明明有内存空间,但是由于不连续,申请稍微大一些的对象无法做到)

### 标记整理算法

* 分为标记和整理两个阶段
* 标记阶段的操作和标记清除一致
* 清除阶段会先执行整理，移动对象的位置

**优点:**

* 减少碎片化空间

**缺点:**

* 不会立即回收垃圾对象
* 移动对象需要消耗一定的时间，回收效率慢

## V8垃圾回收